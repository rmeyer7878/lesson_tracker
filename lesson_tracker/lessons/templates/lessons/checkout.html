<!-- lessons/templates/lessons/checkout.html -->

{% extends 'lessons/base.html' %}
{% block content %}
<h2>Checkout</h2>

{% load custom_filters %}
<table>
    <thead>
        <tr>
            <th>Lesson</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        {% for lesson_id, item in cart.items %}
        <tr>
            <td>{{ item.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>${{ item.price|floatformat:2 }}</td>
            <td>${{ item.price|mul:item.quantity|floatformat:2 }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<p><strong>Grand Total:</strong> ${{ total|floatformat:2 }}</p>

{% comment %} <form id="payment-form" method="post">
    {% csrf_token %}
    <button id="checkout-button" type="button">Confirm and Pay</button>
</form>

<script src="https://js.stripe.com/v3/"></script>
<script>
    var stripe = Stripe("{{ pk_live_51QFGwpGDL4lvksN9BTMaglU0yBsMdtMwajbRRmmqZxrDJ8KeG4awlO1uRF0KmxCRsP6JHaocRLR8W5iWircABVe7008c6igFvO }}");

    document.getElementById("checkout-button").addEventListener("click", function () {
        stripe.redirectToCheckout({
            sessionId: "{{ checkout_session_id }}"
        }).then(function (result) {
            if (result.error) {
                alert(result.error.message);
            }
        });
    });
</script> {% endcomment %}

<button id="checkout-button" type="button">Confirm and Pay</button>

<script src="https://js.stripe.com/v3/"></script>
<script>
    document.getElementById("checkout-button").addEventListener("click", function () {
        var stripe = Stripe("{{ stripe_public_key }}");
        
        if ("{{ checkout_session_id }}") {
            stripe.redirectToCheckout({
                sessionId: "{{ checkout_session_id }}"
            }).then(function (result) {
                if (result.error) {
                    alert(result.error.message);
                }
            });
        } else {
            console.error("Stripe checkout session ID is missing.");
            alert("An error occurred. Please try again later.");
        }
    });
</script>



{% endblock %}
